digraph events {
  node [shape=record];

  user_input   [label = "User Input"];
  fire_event   [label = "Fire Event"];
  rotate_event [label = "Rotate Event"];
  simulation_reset [label = "Simulation Reset"];
  route_fire   [label = "Route Fire Event"];
  route_rotate [label = "Route Rotate Event"];
  simulation   [label = "Simulation"];
  broadcast    [label = "Broadcast"];
  broadcast_except    [label = "Broadcast Except Self"];
  collision_event [label = "Collision Event"];
  hot_event [label = "Hot Event"];

  physics [label = "Physics"];

  physics -> simulation [dir=both];

  user_input -> rotate_event -> route_rotate;
  user_input -> fire_event -> route_fire -> broadcast;
  rotate_event -> simulation;
  simulation_reset -> broadcast;
  collision_event -> broadcast;
  broadcast -> simulation;

  route_rotate -> broadcast_except;

  subgraph cluster_client {
	  label = "Client";
	  user_input;
	  physics;
	  simulation;
	  subgraph cluster_events {
		  label = "Events";
		  fire_event;
		  rotate_event;
		  hot_event;
	  }
	  hot_event -> simulation;
  }

  subgraph cluster_server {
	  label = "Server";
	  subgraph cluster_server_o {
		  label = "originating";
		  {rank=same simulation_reset collision_event}
	  }
	  subgraph cluster_server_r {
		  label = "routed";
		  {rank=same route_fire route_rotate}
	  }
  }

}